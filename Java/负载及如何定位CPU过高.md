#### 参考于
#### [什么是负载？如何查看服务器的机器负载情况](https://blog.csdn.net/Alen_xiaoxin/article/details/88702032)  
#### [什么是负载？如何查看服务器的机器负载情况](http://www.elecfans.com/baike/computer/fuwuqi/20180603688904.html)  


#### 什么是负载（load）
1. 在UNIX系统中，系统负载是对当前CPU工作量的度量，被定义为特定时间间隔内运行队列中的平均线程数。load average 表示机器一段时间内的平均load。这个值越低越好。负载过高会导致机器无法处理其他请求及操作，甚至导致死机。  
2. Linux的负载高，主要是由于CPU使用、内存使用、IO消耗三部分构成。任意一项使用过多，都将导致服务器负载的急剧攀升。  

#### 查看机器负载
1. uptime, uptime命令可以显示的信息显示依次为：1）现在时间、2）系统已经运行了多长时间、3）目前有多少登陆用户、4）系统在过去的1分钟、5分钟和15分钟内的平均负载。  
2. top, top命令是Linux下常用的性能分析工具，能够实时显示系统中各个进程的资源占用状况，类似于Windows的任务管理器  
3. w, 主要功能其实是显示目前登入系统的用户信息  

#### 机器的正常负载范围
1. 一般认为单核 CPU （逻辑核，一般说几核机器，也是逻辑核）的负载应该在 0.7，但是应该根据不同的任务类型灵活改变，批任务处理引起的负载增高，load 部分增高是正常的  
2. 对一般的系统来说，是根据cpu数量去判断系统是否已经过载（Over Load）的。如果我们认为0.7算是单核机器负载的安全线的话，那么四核机器的负载最好保持在3（4*0.7=2.8）以下  
3. 当系统负荷持续大于0.7，就可以准备调查，当系统负荷持续大于1.0，则必须动手寻找解决办法，把他降下来  
4. 1分钟系统负荷表示最近的暂时现象。15分钟系统负荷表示是持续现象，并非暂时问题。如果load15较高，而load1较低，可以认为情况有所好转。反之，情况可能在恶化。  

#### 如何定位 CPU 或 高负载？
1. top ，找到 CPU 最高的进程
2. top -Hp pid ，查看那个线程的占用率较高
3. printf %x tid ，打印出具体线程的16进制
4. jstack pid | grep -A 200 tid_16进制 ，使用jstack命令查看当前线程正在执行的方法
5. 排查指定方法的代码异常

#### 如何降低负载
1. 硬件问题：那么说明机器性能确实就不行了，那么解决起来很简单，直接换机器就可以了。
2. 软件问题：有可能由于Java中的某些线程被长时间占用、大量内存持续占用等导致。建议从以下几个方面排查代码问题：
> 1）是否有内存泄露导致频繁GC  
> 2）是否有死锁发生  
> 3）是否有大字段的读写  
> 4）会不会是数据库操作导致的，排查SQL语句问题  
#### 实操经验：如果发现线上机器Load飙高，可以考虑先把堆栈内存dump下来后，进行重启，暂时解决问题，然后再考虑回滚和排查问题。


